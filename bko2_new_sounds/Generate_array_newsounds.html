<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="jspsych-6.3.0/jspsych.js"></script>
    <script src="jspsych-6.3.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.3.0/plugins/jspsych-html-button-response.js"></script>
    <script src="jspsych-6.3.0/plugins/bouba-kiki.js"></script>
    <script src="jspsych-6.3.0/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych-6.3.0/plugins/jspsych-audio-keyboard-response.js"></script>
    <script src="jspsych-6.3.0/plugins/jspsych-preload.js"></script>
    <link href="jspsych-6.3.0/css/jspsych.css" rel="stylesheet" type="text/css">
    <link href="rotate.css" rel="stylesheet" type="text/css">
  </head>
  <body></body>
  <script>


/* //create timeline

    */
// manually preload these files, since not on standard jspsych preload
  var audio = ['sound2/up2.wav'];
    
  var preload = {
      type: 'preload',
      auto_preload: true,  // automatic preload of stimulus files
      audio: audio,  // manual preload of other files
      images: ["img/bouba_7_L.png","img/bouba_7_L_R.png","img/bouba_7_S_R.png","img/bouba_7_S.png","img/kiki_7_L.png","img/kiki_7_L_R.png","img/kiki_7_S_R.png","img/kiki_7_S.png"]
    };


var timeline = [];
var PracArray = []
var combo_array = []
var trial_block = []
var soundArr = ["sound/lili.wav","sound/titi.wav","sound/didi.wav","sound/sisi.wav","sound/kiki.wav","sound/mimi.wav","sound/zizi.wav","sound/fifi.wav","sound/DADA.wav","sound/KAKA.wav","sound/SASA.wav","sound/MAMA.wav","sound/ZAZA.wav","sound/FAFA.wav","sound/LALA.wav","sound/TATA.wav"];

var boubaArr_L = ["img/bouba_7_L.png","img/bouba_7_L_R.png"];
var boubaArr_S = ["img/bouba_7_S_R.png","img/bouba_7_S.png"];
var kikiArr_L = ["img/kiki_7_L.png","img/kiki_7_L_R.png"];
var kikiArr_S = ["img/kiki_7_S_R.png","img/kiki_7_S.png"];

//generating an array called combo_array with visual stimuli, B shape on one side and K shape on the other
for (let i = 0; i<boubaArr_L.length; i++){
    var boubaArr_L = jsPsych.randomization.sampleWithoutReplacement(boubaArr_L, boubaArr_L.length);
      for (let j = 0; j<kikiArr_L.length; j++){
           combo_array.push([boubaArr_L[i],kikiArr_L[j]])
           combo_array.push([boubaArr_S[i],kikiArr_S[j]])
           combo_array.push([kikiArr_L[j], boubaArr_L[i]])
           combo_array.push([kikiArr_S[j], boubaArr_S[i]])
      }
};

console.log(combo_array);

//while loop creates a shuffled array, then checks it to see if there are 3 in a row. if there are, it runs again until it can make one that does not have 3 in a row
//creates a shuffled array of sound stimuli where there are no more than 2 "a" or "i" sounds in a row
var reading_frame = 3
var three_in_row = true

while (three_in_row) {
    var soundArr = jsPsych.randomization.sampleWithoutReplacement(soundArr, soundArr.length);
    //var soundArr_a = jsPsych.randomization.sampleWithoutReplacement(soundArr_a, soundArr_a.length);    

    three_in_row = false;

    for(i = 0; i <= soundArr.length-reading_frame; i++){
        to_read = soundArr.slice(i,i+reading_frame);
        all_equal = to_read.every( v => v.includes("A")) || to_read.every( v => v.includes("i"));
        //using a capital "A" and lowercase "i" to differentiate the 2 types of sounds. includes() is case sensitive. 
            
            //console.log(to_read)
            //only if it has seen 2 in a row will this make three_in_row equal true, which makes the loop run again until it gets it right
        if(all_equal){
            three_in_row = true;
            }
        }
}

    console.log("\n We're done!")
    console.log(soundArr)

//creates a newly shuffled combo_array where there are no more than 2 K or B shapes on one side in a row
var bouba_reading_frame = 3
var bouba_three_in_row = true

while (bouba_three_in_row) {
    var combo_array = jsPsych.randomization.sampleWithoutReplacement(combo_array, combo_array.length);

    bouba_three_in_row = false;

    //will return the 0th iten in each inner array, then check to see if it has 3 equal in a row
    for(i = 0; i <= combo_array.length-reading_frame; i++){
        to_read = combo_array.slice(i,i+reading_frame).map(function(x) {
                                                                        return x[0]; //returning the 0th item in i of combo_array
                                                                        });
        all_equal = to_read.every( v => v.includes("bouba")) || to_read.every( v => v.includes("kiki"));
            
            //console.log(to_read)
            //only if it has seen 2 in a row will this make three_in_row equal true, which makes the loop run again until it gets it right
        if(all_equal){
            bouba_three_in_row = true;
            }
        }
};    

//adds each triad (1 audio stim and 2 visual stim) to the trial_block array
for (let i = 0; i<combo_array.length; i++){
    trial_block.push({ stimulus: soundArr[i], imageLeft:combo_array[i][0], imageRight:combo_array[i][1]})
};

var exp_trials = [];

for (let i = 0; i<63; i++){
    exp_trials.push(trial_block[i])
};

var leftButton = "z";
var rightButton = "m";

console.log(trial_block);
console.log(combo_array);
console.log(exp_trials);

//READY UP
var ready = {
  type: "html-button-response",
  stimulus: '<div style="max-width:600px;"><p>Ready to begin? Press Continue to begin the trials.</p>',
  choices: ['Continue'],
};
timeline.push(ready);

//TEST TRIAL
var trial = {
      type: 'bouba-kiki',
      upsound: 'sound2/up2.wav',
      stimulus: jsPsych.timelineVariable('stimulus'),
      image:[jsPsych.timelineVariable('imageLeft'),jsPsych.timelineVariable('imageRight')],
      data: {
        left_image: [jsPsych.timelineVariable('imageLeft')],
        right_image: [jsPsych.timelineVariable('imageRight')],
      }
    }

var test_procedure = {
      timeline: [trial],
      timeline_variables: trial_block,
    };

timeline.push(test_procedure);

    jsPsych.init({
      timeline: timeline,
    //   preload_audio: ['PracSounds/1.wav'],
    //   preload_images: ['PracImgs/1.png', 'PracImgs/2.png'],
      on_finish: function(){
        jsPsych.data.displayData();
      }
    }); 






// var NumArr = [0,1,2,3,4,5,6,7];

// var leftButton = "z";
// var rightButton = "m";

// for (let i = 0; i < 4; i++){
//     var EightNums = jsPsych.randomization.sampleWithoutReplacement(NumArr, 8);
//     for (let j = 0; j < 4; j++){
//         num1 = EightNums[j*2]
//         num2 = EightNums[j*2+1]

//         //If it is less than 3 long just add randomly
//         if (PracArray.length < 3){
//           if (Math.random() > 0.5){
//             PracArray.push({ stimulus: soundArr[num1], imageLeft:imageArr[num1], imageRight:imageArr[num2], correct_response:leftButton})
//           }
//           else{
//             PracArray.push({ stimulus: soundArr[num1], imageLeft:imageArr[num2], imageRight:imageArr[num1], correct_response:rightButton})
//           }
//         }
//         //If there are 3 or more entries already make sure the last 3 are not the same.
//         else{

//           //Get an array of the last 3 values
//           lastThree = PracArray.slice(-3);
//           lastThreeCorrect = [];
//           for (var k=0;k<3;k++){
//             lastThreeCorrect.push(lastThree[k].correct_response)
//           }

//           //Now check if they are all the same
//           all_equal = lastThreeCorrect.every( v => v === lastThreeCorrect[0] )

//           console.log(lastThreeCorrect)
//           console.log(all_equal)

//           //If they are all the same and right make the next one left 
//           if(all_equal && lastThreeCorrect[0] == rightButton){
//             PracArray.push({ stimulus: soundArr[num1], imageLeft:imageArr[num1], imageRight:imageArr[num2], correct_response:leftButton})
//             console.log("Forced Left")
//           }
//           //If they are all the same and left make the next one right 
//           else if(all_equal && lastThreeCorrect[0] == leftButton){
//             console.log("Forced Right")
//             PracArray.push({ stimulus: soundArr[num1], imageLeft:imageArr[num2], imageRight:imageArr[num1], correct_response:rightButton})
//           }
//           //Otherwise select randomly
//           else{
//             if (Math.random() > 0.5){
//               PracArray.push({ stimulus: soundArr[num1], imageLeft:imageArr[num1], imageRight:imageArr[num2], correct_response:leftButton})
//             }
//             else{
//               PracArray.push({ stimulus: soundArr[num1], imageLeft:imageArr[num2], imageRight:imageArr[num1], correct_response:rightButton})
//             }
//           }
//         }

        
//     }
// }
// console.log(PracArray)

// correctKeys = [];
// for (var i=0;i<PracArray.length;i++){
//   correctKeys.push(PracArray[i].correct_response)
// }

// console.log(correctKeys)



  </script>
</html>