<!DOCTYPE html> 
<html>
  <head>
    <title>My experiment</title>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych/plugins/jspsych-audio-keyboard-response.js"></script>
    <link href="jspsych/css/jspsych.css" rel="stylesheet" type="text/css">
    <link href="rotate.css" rel="stylesheet" type="text/css">
  </head>
  <body></body>
  <script>

    /* create timeline */
    var timeline = [];

    /* define welcome message trial */
    var welcome = {
      type: "html-keyboard-response",
      stimulus: "Welcome to the experiment. Press any key to begin."
    };
    timeline.push(welcome);

    /* define instructions trial */
    var instructions = {
      type: "html-keyboard-response",
      stimulus: "<p>In this experiment, two shapes will appear side by side in the middle " +
          "of the screen.</p><p>If the <strong>left<strong> shape is a better match for the sound, " +
          "press the letter F on the keyboard as fast as you can.</p>" +
          "<p>If the <strong>right<strong> shape is a better match for the sound, press the letter J " +
          "as fast as you can.</p>" +
          "<div style='width: 100px;'>"+
          "<div style='float: left;'><img src='img/bouba_3_L.png'></img>" +
          "<p class='small'><strong>Press the F key</strong></p></div>" +
          "<div class='float: right;'><img src='img/kiki_3_L.png'></img>" +
          "<p class='small'><strong>Press the J key</strong></p></div>" +
          "</div>"+
          "<p>Press any key to begin.</p>",
      post_trial_gap: 1000
    };
    timeline.push(instructions);

        /* test trials */
    var fixation_cross = {
      type: 'html-keyboard-response',
      stimulus: '<div style="font-size:60px;">+</div>',
      choices: jsPsych.NO_KEYS,
      trial_duration: 1000
    }

    var audio_image_1 = {
      type: 'audio-keyboard-response',
      stimulus: 'sound/up2.wav',
      choices: jsPsych.NO_KEYS,
      prompt: function () {
        var html = "<div class=wrapper><img src=" + jsPsych.timelineVariable('shape1') + " class=zoom class=box width=100 height=100 /><div style=font-size:60px;>+</div><img src=" + jsPsych.timelineVariable('shape2') + " class=zoom class=box width=100 height=100/></div>";
        return html;
      },
      trial_duration: 2000,
    }

    var audio_image_2 = {
      type: 'audio-keyboard-response',
      stimulus: jsPsych.timelineVariable('sound'),
      choices: ['f', 'j'],
      prompt: function () {
        var html = "<div class=wrapper><img src=" + jsPsych.timelineVariable('shape1') + " class=box width=100 height=100 /><div style=font-size:60px;>+</div><img src=" + jsPsych.timelineVariable('shape2') + " class=box width=100 height=100/></div>";
        return html;
      }
    }

    var conditional_audio_image_1 = {
      timeline: [
        {
          type: 'audio-keyboard-response',
          stimulus: 'sound/go.wav',
          choices: jsPsych.NO_KEYS,
          prompt: function () {
            var html = "<div class=wrapper><img src=" + jsPsych.timelineVariable('shape1') + " class=rotate class=box width=100 height=100 /><div style=font-size:60px;>+</div><img src=" + jsPsych.timelineVariable('shape2') + " class=box width=100 height=100/></div>";
            return html;
          },
          trial_duration: 1000,
        }],
      conditional_function: function () {
        // get the data from the previous trial,
        // and check which key was pressed
        var data = jsPsych.data.get().last(1).values()[0];
        if (jsPsych.pluginAPI.compareKeys(data.response, 'f')) {
          return true;
        } else {
          return false;
        }
      }
    }

    var conditional_audio_image_2 = {
      timeline: [
        {
          type: 'audio-keyboard-response',
          stimulus: 'sound/go.wav',
          choices: jsPsych.NO_KEYS,
          prompt: function () {
            var html = "<div class=wrapper><img src=" + jsPsych.timelineVariable('shape1') + " class=box width=100 height=100 /><div style=font-size:60px;>+</div><img src=" + jsPsych.timelineVariable('shape2') + " class=rotate class=box width=100 height=100/></div>";
            return html;
          },
          trial_duration: 1000,
        }],
      conditional_function: function () {
        // get the data from the previous trial,
        // and check which key was pressed
        var data = jsPsych.data.get().last(1).values()[0];
        if (jsPsych.pluginAPI.compareKeys(data.response, 'j')) {
          return true;
        } else {
          return false;
        }
      }
    }

    var test_procedure = {
      timeline: [fixation_cross, audio_image_1, audio_image_2, conditional_audio_image_1, conditional_audio_image_2],
      timeline_variables: [
        { sound: 'sound/teetee.wav', shape1: "img/bouba_3_L.png", shape2: "img/kiki_3_L.png" },
        { sound: 'sound/keekee.wav', shape1: "img/kiki_3_L.png", shape2: "img/bouba_3_L.png" }
      ]
    }

    // var test_procedure = {
    //     timeline: [fixation, audio, test],
    //     timeline_variables: test_stimuli,
    //     randomize_order: true,
    //     repetitions: 5
    // }

    timeline.push(test_procedure);

    /* start the experiment */
    jsPsych.init({
      timeline: timeline
    });

  </script>
  </html> 