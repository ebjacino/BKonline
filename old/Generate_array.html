<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych/plugins/bouba-kiki.js"></script>
    <script src="jspsych/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych/plugins/jspsych-audio-keyboard-response.js"></script>
    <link href="jspsych/css/jspsych.css" rel="stylesheet" type="text/css">
    <link href="rotate.css" rel="stylesheet" type="text/css">
  </head>
  <body></body>
  <script>


/* //create timeline
var timeline = [];

var welcome = {
      type: "html-keyboard-response",
      stimulus: "Welcome to the experiment. Press any key to begin."
    };

var stimulus = {
    stimulus: 'PracSounds/1.wav',imageLeft:'PracImgs/1.png',imageRight:"PracImgs/2.png"
}


var trial = {
    type: 'bouba-kiki',
    upsound: 'sound/up2.wav',

    stimulus: jsPsych.timelineVariable('stimulus'),
    image:[jsPsych.timelineVariable('imageLeft'),jsPsych.timelineVariable('imageRight')],
    data: {
      width: w,
      height: h,
      left_image: [jsPsych.timelineVariable('imageLeft')],
      right_image: [jsPsych.timelineVariable('imageRight')],
      
    },
    on_finish: function(data) {
        // at the end of each trial, update the progress bar
        // based on the current value and the proportion to update for each trial
        var curr_progress_bar_value = jsPsych.getProgressBarCompleted();
        jsPsych.setProgressBar(curr_progress_bar_value + (1/n_trials));
        
        // End experiment and save the progress 
         if(jsPsych.pluginAPI.compareKeys(data.response, "escape")){
      jsPsych.endExperiment('The experiment was ended by pressing "escape".');
         }
    }
  };


  timeline.push(welcome);
  timeline.push(trial);

  jsPsych.init({
      timeline: timeline,
      preload_audio: ['PracSounds/1.wav'],
      preload_images: ['PracImgs/1.png', 'PracImgs/2.png'],
      on_finish: function(){
        jsPsych.data.displayData();
      }
    }); 
    */




var PracArray = []
var imageArr = ["PracImgs/1.png","PracImgs/2.png","PracImgs/3.png","PracImgs/4.png","PracImgs/5.png","PracImgs/6.png","PracImgs/7.png","PracImgs/8.png"];
var soundArr = ["PracSounds/1.wav","PracSounds/2.wav","PracSounds/3.wav","PracSounds/4.wav","PracSounds/5.wav","PracSounds/6.wav","PracSounds/7.wav","PracSounds/8.wav"];

var NumArr = [0,1,2,3,4,5,6,7];

var leftButton = "shiftleft";
var rightButton = "shiftright";

for (let i = 0; i < 4; i++){
    var EightNums = jsPsych.randomization.sampleWithoutReplacement(NumArr, 8);
    for (let j = 0; j < 4; j++){
        num1 = EightNums[j*2]
        num2 = EightNums[j*2+1]

        //If it is less than 3 long just add randomly
        if (PracArray.length < 3){
          if (Math.random() > 0.5){
            PracArray.push({ stimulus: soundArr[num1], imageLeft:imageArr[num1], imageRight:imageArr[num2], correct_response:leftButton})
          }
          else{
            PracArray.push({ stimulus: soundArr[num1], imageLeft:imageArr[num2], imageRight:imageArr[num1], correct_response:rightButton})
          }
        }
        //If there are 3 or more entries already make sure the last 3 are not the same.
        else{

          //Get an array of the last 3 values
          lastThree = PracArray.slice(-3);
          lastThreeCorrect = [];
          for (var k=0;k<3;k++){
            lastThreeCorrect.push(lastThree[k].correct_response)
          }

          //Now check if they are all the same
          all_equal = lastThreeCorrect.every( v => v === lastThreeCorrect[0] )

          console.log(lastThreeCorrect)
          console.log(all_equal)

          //If they are all the same and right make the next one left 
          if(all_equal && lastThreeCorrect[0] == rightButton){
            PracArray.push({ stimulus: soundArr[num1], imageLeft:imageArr[num1], imageRight:imageArr[num2], correct_response:leftButton})
            console.log("Forced Left")
          }
          //If they are all the same and left make the next one right 
          else if(all_equal && lastThreeCorrect[0] == leftButton){
            console.log("Forced Right")
            PracArray.push({ stimulus: soundArr[num1], imageLeft:imageArr[num2], imageRight:imageArr[num1], correct_response:rightButton})
          }
          //Otherwise select randomly
          else{
            if (Math.random() > 0.5){
              PracArray.push({ stimulus: soundArr[num1], imageLeft:imageArr[num1], imageRight:imageArr[num2], correct_response:leftButton})
            }
            else{
              PracArray.push({ stimulus: soundArr[num1], imageLeft:imageArr[num2], imageRight:imageArr[num1], correct_response:rightButton})
            }
          }
        }

        
    }
}
console.log(PracArray)

correctKeys = [];
for (var i=0;i<PracArray.length;i++){
  correctKeys.push(PracArray[i].correct_response)
}

console.log(correctKeys)



  </script>
</html>